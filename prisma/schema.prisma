generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(cuid())
  name          String?
  email         String    @unique
  emailVerified DateTime?
  image         String?
  password      String?
  role          UserRole  @default(CLIENT)
  phone         String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // Client-specific fields
  savedProperties  SavedProperty[]
  appointments     Appointment[]
  documents        Document[]
  searchPreferences Json?

  // Agent-specific fields
  specialty        String?
  bio              String?
  propertiesManaged Property[]
  appointmentsHandled Appointment[] @relation("AgentAppointments")

  @@index([email])
  @@index([role])
}

enum UserRole {
  CLIENT
  AGENT
  COORDINATOR
  ADMIN
}

model Property {
  id              String   @id @default(cuid())
  title           String
  description     String   @db.Text
  price           Float
  address         String
  city            String
  state           String
  zipCode         String?
  latitude        Float?
  longitude       Float?

  type            PropertyType
  status          PropertyStatus @default(AVAILABLE)

  bedrooms        Int
  bathrooms       Float
  squareMeters    Float
  yearBuilt       Int?

  features        Json?
  amenities       String[]

  images          PropertyImage[]
  videoUrl        String?
  tour360Url      String?
  floorPlanUrl    String?

  agentId         String
  agent           User     @relation(fields: [agentId], references: [id])

  views           Int      @default(0)
  savedBy         SavedProperty[]
  appointments    Appointment[]

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  publishedAt     DateTime?
  soldAt          DateTime?

  @@index([status])
  @@index([type])
  @@index([price])
  @@index([city])
  @@index([agentId])
}

enum PropertyType {
  HOUSE
  APARTMENT
  LAND
  COMMERCIAL
  PENTHOUSE
  VILLA
}

enum PropertyStatus {
  DRAFT
  AVAILABLE
  RESERVED
  SOLD
  PAUSED
}

model PropertyImage {
  id          String   @id @default(cuid())
  url         String
  publicId    String
  order       Int      @default(0)
  isPrimary   Boolean  @default(false)
  propertyId  String
  property    Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  createdAt   DateTime @default(now())

  @@index([propertyId])
  @@index([isPrimary])
}

model SavedProperty {
  id         String   @id @default(cuid())
  userId     String
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  propertyId String
  property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  createdAt  DateTime @default(now())

  @@unique([userId, propertyId])
  @@index([userId])
  @@index([propertyId])
}

model Appointment {
  id              String            @id @default(cuid())
  propertyId      String
  property        Property          @relation(fields: [propertyId], references: [id])
  userId          String
  user            User              @relation(fields: [userId], references: [id])
  agentId         String
  agent           User              @relation("AgentAppointments", fields: [agentId], references: [id])

  scheduledAt     DateTime
  endTime         DateTime
  type            AppointmentType
  status          AppointmentStatus @default(PENDING)

  clientName      String
  clientEmail     String
  clientPhone     String
  message         String?

  notes           String?
  cancelReason    String?

  confirmedAt     DateTime?
  completedAt     DateTime?
  cancelledAt     DateTime?

  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt

  @@index([propertyId])
  @@index([userId])
  @@index([agentId])
  @@index([scheduledAt])
  @@index([status])
}

enum AppointmentType {
  IN_PERSON
  VIDEO_CALL
}

enum AppointmentStatus {
  PENDING
  CONFIRMED
  COMPLETED
  CANCELLED
  NO_SHOW
}

model Document {
  id          String   @id @default(cuid())
  title       String
  description String?
  fileUrl     String
  fileType    String
  userId      String
  user        User     @relation(fields: [userId], references: [id])
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([userId])
}

model Lead {
  id          String     @id @default(cuid())
  name        String
  email       String
  phone       String
  source      LeadSource @default(WEBSITE)
  status      LeadStatus @default(NEW)
  propertyId  String?
  budget      Float?
  message     String?
  notes       String?
  assignedTo  String?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  @@index([status])
  @@index([source])
  @@index([assignedTo])
}

enum LeadSource {
  WEBSITE
  WHATSAPP
  FACEBOOK
  INSTAGRAM
  REFERRAL
  OTHER
}

enum LeadStatus {
  NEW
  CONTACTED
  INTERESTED
  NEGOTIATING
  CLOSED
  LOST
}

model Testimonial {
  id          String   @id @default(cuid())
  clientName  String
  clientImage String?
  propertyBought String?
  quote       String   @db.Text
  rating      Int      @default(5)
  videoUrl    String?
  featured    Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([featured])
}
